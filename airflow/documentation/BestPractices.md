# 最佳实践
创建一个新的 DAG 分为两步：1, 编写 Python 代码来创建 DAG 对象，2, 测试代码是否符合我们的期望。本教程将向您介绍这两个步骤的最佳实践。
## 编写 DAG
### 创建自定义运算符/挂钩
请按照我们的[自定义操作员](https://airflow.apache.org/docs/apache-airflow/2.2.5/howto/custom-operator.html#custom-operator)指南进行操作。
### 创建任务
* 您应该将 Airflow 中的任务等同于数据库中的事务。这意味着你永远不应该从你的任务中产生不完整的结果。
* 如果失败，Airflow 可以重试任务。因此，任务应该在每次重新运行时产生相同的结果。
### 删除任务
从 DAG 中删除任务时要小心。您将无法在图形视图、树视图等中看到任务，这使得从 Web 服务器检查该任务的日志变得困难。如果不需要，请创建一个新的 DAG。
### 沟通
使用 XCom 在任务之间传递小消息，在任务之间传递较大数据的一种好方法是使用远程存储，
### 顶级 Python 代码
影响 DAG 加载时间的重要因素之一，可能被 Python 开发人员忽视的是，顶级导入可能会花费惊人的大量时间，并且它们会产生大量开销，所以应该避免编写不需要的顶级代码。
### 动态 DAG 生成
避免在顶层代码进行过多处理，基本上可以通过以下方式之一进行配置：
* 通过环境变量

通过外部提供的生成的 Python 代码，在 DAG 文件夹中包含元数据

通过外部提供的 DAG 文件夹中生成的配置元数据文件
具有环境变量的动态 DAG
使用嵌入的元数据生成 Python 代码
具有来自结构化数据文件的外部配置的动态 DAG
气流变量
更改后触发 DAG
具有触发规则的观察者模式示例
降低 DAG 复杂性
测试 DAG
DAG 加载器测试
单元测试
自查
暂存环境
模拟变量和连接