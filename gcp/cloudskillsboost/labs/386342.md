# [概览](https://www.cloudskillsboost.google/course_sessions/5373174/labs/386342)
高可用性 VPN 是一种高可用性 (HA) Cloud VPN 解决方案，可让您在单个区域中通过 IPsec VPN 连接将您的本地网络安全地连接到 VPC 网络。高可用性 VPN 提供服务可用性达 99.99% 的服务等级协议 (SLA)。

高可用性 VPN 是一种可为各个 VPC 网络添加的区域级 VPN 解决方案。高可用性 VPN 网关有两个接口，每个接口都有自己的公共 IP 地址。创建高可用性 VPN 网关时，系统会自动从不同的地址池中选择两个公共 IP 地址。在为高可用性 VPN 配置两个隧道后，Cloud VPN 可以提供服务可用性达 99.99% 的正常运行时间。

在本实验中，您将创建一个名为 vpc-demo 的全局性 VPC，其中包含位于 us-east1 和 us-central1 两个区域的两个自定义子网。在此 VPC 中，您将在每个区域添加一个 Compute Engine 实例。然后创建名为 on-prem 的第二个 VPC 来模拟客户的本地数据中心。在第二个 VPC 中，您将在 us-central1 区域中添加一个子网和一个在该区域运行的 Compute Engine 实例。最后，您将在每个 VPC 中添加一个高可用性 VPN 和一个 Cloud Router 路由器，并从每个高可用性 VPN 网关运行两个隧道，然后再测试该配置能否达到服务等级协议 (SLA) 承诺的 99.99% 的可用性。
![](../images/HA-VPN.png)

# 目标
在本实验中，您将学习如何执行以下任务：
* 创建两个 VPC 网络和多个实例。
* 配置高可用性 VPN 网关。
* 使用 VPN 隧道配置动态路由。
* 配置全局动态路由模式。
* 验证并测试高可用性 VPN 网关的配置。

# 设置和要求
略

# 任务 1. 设置全局 VPC 环境
* 设置一个全局 VPC 和自定义子网并创建防火墙规则。
* 配置虚拟机

# 任务 2. 设置模拟的本地环境
* 设置一个全局 VPC 和自定义子网并创建防火墙规则。
* 配置虚拟机

# 任务 3. 设置高可用性 VPN 网关
* 创建高可用性 VPN 网关
* 创建 Cloud Router 路由器

# 任务 4. 创建两个 VPN 隧道
* 在 Cloud VPN 网关上创建高可用性 VPN 隧道

# 任务 5. 为每个隧道创建边界网关协议 (BGP) 对等互联
> 边界网关协议（Border Gateway Protocol，BGP）是一种路由协议，通常用于互联网中的路由器之间进行路由信息交换。
> BGP 是一种路径矢量协议，用于确定数据包应该如何在互联网中传播，以确保数据包从源路由器到达目标路由器。

# 任务 6. 验证路由器配置
* 验证两个 VPC 中的路由器配置。配置防火墙规则以允许各个 VPC 之间传递流量，并验证隧道的状态。您还要验证各个 VPC 之间的 VPN 专用连接，并为 VPC 启用全局路由模式。

# 任务 7. 验证并测试高可用性 VPN 隧道的配置
略

# 任务 8. （可选）清理实验环境
略

# 任务 9. 回顾
在本实验中，您配置了高可用性 VPN 网关。您还使用 VPN 隧道配置了动态路由，并配置了全局动态路由模式。最后，您通过验证确认了高可用性 VPN 已配置且运行正常。